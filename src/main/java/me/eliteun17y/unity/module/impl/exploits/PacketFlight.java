package me.eliteun17y.unity.module.impl.exploits;

import me.eliteun17y.unity.event.Direction;
import me.eliteun17y.unity.event.Subscribe;
import me.eliteun17y.unity.event.impl.EventPacket;
import me.eliteun17y.unity.event.impl.EventPlayerMotionUpdate;
import me.eliteun17y.unity.event.impl.EventUpdate;
import me.eliteun17y.unity.module.Category;
import me.eliteun17y.unity.module.Module;
import me.eliteun17y.unity.util.player.PlayerUtil;
import me.eliteun17y.unity.util.setting.impl.NumberValue;
import me.eliteun17y.unity.util.world.TimerUtil;
import net.minecraft.network.play.client.CPacketConfirmTeleport;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.server.SPacketPlayerPosLook;
import org.lwjgl.input.Keyboard;

public class PacketFlight extends Module {
    public NumberValue speed = new NumberValue(this, "Speed", 0.03, 0.1f, 0, 0.01);
    public PacketFlight() {
        super("Packet Flight", "Allows you to bypass anticheats to fly.", Category.EXPLOITS, Keyboard.KEY_NONE);
    }

    @Subscribe
    public void onPlayerMotionUpdate(EventPlayerMotionUpdate event) {
        if(event.isPost()) return;
        mc.player.setVelocity(0, 0, 0);
        if(mc.player.movementInput.jump)
            mc.player.motionY = 0.03f;

        if(mc.player.movementInput.sneak)
            mc.player.motionY = -0.03f;

        PlayerUtil.strafe(speed.getDouble());
        mc.player.noClip = true;
        mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(mc.player.posX + mc.player.motionX, mc.player.posY + mc.player.motionY, mc.player.posZ + mc.player.motionZ, mc.player.rotationYaw, mc.player.rotationPitch, mc.player.onGround));
        mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(mc.player.posX + mc.player.motionX, 10000, mc.player.posZ + mc.player.motionZ, mc.player.rotationYaw, mc.player.rotationPitch, mc.player.onGround));
        mc.getConnection().sendPacket(new CPacketConfirmTeleport(mc.player.ticksExisted));
    }

    @Subscribe
    public void onPacket(EventPacket event) {
        if(event.getDirection() == Direction.OUTGOING) return;
        if(mc.currentScreen != null) return;
        if(event.getPacket() instanceof SPacketPlayerPosLook) {
            mc.getConnection().sendPacket(new CPacketConfirmTeleport(((SPacketPlayerPosLook) event.getPacket()).getTeleportId()));
            mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(((SPacketPlayerPosLook) event.getPacket()).getX(), ((SPacketPlayerPosLook) event.getPacket()).getY(), ((SPacketPlayerPosLook) event.getPacket()).getZ(), ((SPacketPlayerPosLook) event.getPacket()).getYaw(), ((SPacketPlayerPosLook) event.getPacket()).getPitch(), false));

            mc.player.setPosition(((SPacketPlayerPosLook) event.getPacket()).getX(), ((SPacketPlayerPosLook) event.getPacket()).getY(), ((SPacketPlayerPosLook) event.getPacket()).getZ());
            event.setCancelled(true);
        }
    }
}
