package me.eliteun17y.unity.module.impl.exploits;

import me.eliteun17y.unity.event.Direction;
import me.eliteun17y.unity.event.Subscribe;
import me.eliteun17y.unity.event.impl.EventPacket;
import me.eliteun17y.unity.module.Category;
import me.eliteun17y.unity.module.Module;
import me.eliteun17y.unity.util.setting.impl.NumberValue;
import me.eliteun17y.unity.util.world.TPSUtil;
import net.minecraft.client.gui.GuiIngameMenu;
import net.minecraft.network.play.client.CPacketKeepAlive;
import org.lwjgl.input.Keyboard;

public class AntiLagKick extends Module {
    public NumberValue tpsThreshold = new NumberValue(this, "TPS Threshold", 2, 19, 1, 1);

    public AntiLagKick() {
        super("Anti Lag Kick", "Prevents you from getting kicked on low TPS.", Category.EXPLOITS, Keyboard.KEY_NONE);
    }

    @Subscribe
    public void onPacket(EventPacket event) {
        if(event.getDirection() == Direction.OUTGOING) {
            if(mc.currentScreen != null && !(mc.currentScreen instanceof GuiIngameMenu)) return;
            if(event.getPacket() instanceof CPacketKeepAlive) return; // Need keepalive packets else we'll do the one thing we're trying to prevent (getting kicked)
            if(TPSUtil.getTPS() <= tpsThreshold.getInt()) {
                event.setCancelled(true);
            }
        }
    }
}
