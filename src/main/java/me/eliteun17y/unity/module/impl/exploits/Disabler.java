package me.eliteun17y.unity.module.impl.exploits;

import me.eliteun17y.unity.event.Direction;
import me.eliteun17y.unity.event.Subscribe;
import me.eliteun17y.unity.event.impl.EventPacket;
import me.eliteun17y.unity.event.impl.EventUpdate;
import me.eliteun17y.unity.module.Category;
import me.eliteun17y.unity.module.Module;
import me.eliteun17y.unity.util.chat.ChatUtil;
import me.eliteun17y.unity.util.setting.impl.ModeValue;
import me.eliteun17y.unity.util.time.Timer;
import me.eliteun17y.unity.util.world.PacketUtil;
import me.eliteun17y.unity.util.world.TimerUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.*;
import net.minecraft.network.play.server.SPacketPlayerPosLook;
import org.lwjgl.input.Keyboard;

import java.util.ArrayList;

public class Disabler extends Module {
    public ModeValue mode = new ModeValue(this, "Mode", "Negativity 1.0", "Negativity 1.0");

    public Timer timer = new Timer();
    public ArrayList<Packet> packets = new ArrayList<>();

    public double posX;
    public double posY;
    public double posZ;

    public Disabler() {
        super("Disabler", "Disables anticheats.", Category.EXPLOITS, Keyboard.KEY_NONE);
    }

    @Override
    public void onEnable() {
        super.onEnable();
        timer.reset();
    }

    @Override
    public void onDisable() {
        super.onDisable();
        TimerUtil.setSpeed(1);
    }

    @Subscribe
    public void onUpdate(EventUpdate event) {

    }

    @Subscribe
    public void onPacket(EventPacket event) {
        switch(mode.getMode()) {
            case "Negativity 1.0":
                if(event.getDirection() == Direction.OUTGOING) {
                    if(event.getPacket() instanceof CPacketPlayer) {
                        if(mc.player.ticksExisted % 12 == 0) {
                            PacketUtil.sendSilentPacket(new CPacketPlayer.Position(0, 100000, 0, true));
                            posX = mc.player.posX;
                            posY = mc.player.posY;
                            posZ = mc.player.posZ;
                            event.setCancelled(true);
                        }
                    }

                    if(event.getPacket() instanceof CPacketConfirmTeleport) {
                        mc.player.setPosition(posX, posY, posZ);
                    }
                }

                if(event.getDirection() == Direction.INCOMING) {
                    if(mc.player.ticksExisted < 20) return;

                    if(event.getPacket() instanceof SPacketPlayerPosLook) {
                        mc.getConnection().sendPacket(new CPacketConfirmTeleport(((SPacketPlayerPosLook) event.getPacket()).getTeleportId()));
                        mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(mc.player.posX, mc.player.getEntityBoundingBox().minY, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch, false));
                        event.setCancelled(true);
                    }
                }

                break;
        }
    }
}
